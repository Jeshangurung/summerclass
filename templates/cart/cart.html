{%extends 'master/base.html'%} 
{%load static%} 
{%block content%}

<!-- Cart Section -->
<section class="section-content">
  <div class="container">
    {% if not cart_items %}
      {% include 'cart/empty_cart.html' %}
    {% else %}
      <div class="row">
        <!-- Cart Items -->
        <div class="col-lg-8">
          <div class="card" style="border-radius: var(--border-radius-large);">
            <div class="card-header" style="background-color: var(--apple-gray-50); border-bottom: 1px solid var(--apple-gray-200);">
              <h4 style="color: var(--apple-black); font-weight: var(--font-weight-semibold); margin-bottom: 0;">Shopping Cart</h4>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-borderless mb-0">
                  <thead style="background-color: var(--apple-gray-50);">
                    <tr>
                      <th scope="col" style="color: var(--apple-gray-600); font-weight: var(--font-weight-medium); padding: 1.5rem 1rem 1rem;">Product</th>
                      <th scope="col" style="color: var(--apple-gray-600); font-weight: var(--font-weight-medium); padding: 1.5rem 1rem 1rem;">Quantity</th>
                      <th scope="col" style="color: var(--apple-gray-600); font-weight: var(--font-weight-medium); padding: 1.5rem 1rem 1rem;">Price</th>
                      <th scope="col" style="color: var(--apple-gray-600); font-weight: var(--font-weight-medium); padding: 1.5rem 1rem 1rem; text-align: right;">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for cart_item in cart_items %}
                    <tr style="border-bottom: 1px solid var(--apple-gray-100);">
                      <td style="padding: 1.5rem 1rem;">
                        <div class="d-flex align-items-center">
                          <img src="{{cart_item.product.images.url}}" class="rounded" style="width: 80px; height: 80px; object-fit: cover; margin-right: 1rem;" alt="{{cart_item.product.product_name}}" />
                          <div>
                            <a href="{{cart_item.product.get_url}}" class="product-title" style="font-size: 1.1rem; margin-bottom: 0.5rem; display: block;">
                              {{cart_item.product.product_name}}
                            </a>
                            {% if cart_item.product.stock <= 0 %}
                              <p style="color: var(--apple-red); font-size: 0.9rem; margin-bottom: 0.5rem;">Out of stock</p>
                            {% elif cart_item.product.stock <= 5 %}
                              <p style="color: var(--apple-red); font-size: 0.9rem; margin-bottom: 0.5rem;">Only {{ cart_item.product.stock }} left!</p>
                            {% endif %}
                            {% if cart_item.variations.all %}
                              <div style="color: var(--apple-gray-500); font-size: 0.9rem;">
                                {% for item in cart_item.variations.all %}
                                  <span style="margin-right: 1rem;">{{item.variation_category|capfirst}}: {{item.variation_value|capfirst}}</span>
                                {% endfor %}
                              </div>
                            {% endif %}
                          </div>
                        </div>
                      </td>
                      <td style="padding: 1.5rem 1rem;">
                        <div class="input-group" style="width: 120px;">
                          <div class="input-group-prepend">
                            <a href="{% url 'remove_cart' cart_item.product.id cart_item.id%}" class="btn btn-outline-secondary" style="border-radius: var(--border-radius-small) 0 0 var(--border-radius-small);">
                              <i class="fa fa-minus"></i>
                            </a>
                          </div>
                          <input type="text" class="form-control text-center" value="{{cart_item.quantity}}" readonly style="border-left: none; border-right: none;" />
                          <div class="input-group-append">
                            {% if cart_item.quantity < cart_item.product.stock %}
                              <form action="{% url 'add_cart' cart_item.product.id %}" method="POST" style="margin: 0;">
                                {% csrf_token %}
                                {% for item in cart_item.variations.all %}
                                  <input type="hidden" name="{{item.variation_category|lower}}" value="{{item.variation_value|capfirst}}">
                                {% endfor %}
                                <button type="submit" class="btn btn-outline-secondary" style="border-radius: 0 var(--border-radius-small) var(--border-radius-small) 0;">
                                  <i class="fa fa-plus"></i>
                                </button>
                              </form>
                            {% else %}
                              <button class="btn btn-outline-secondary" disabled style="border-radius: 0 var(--border-radius-small) var(--border-radius-small) 0;" title="No more stock">
                                <i class="fa fa-plus"></i>
                              </button>
                            {% endif %}
                          </div>
                        </div>
                      </td>
                      <td style="padding: 1.5rem 1rem;">
                        <div>
                          <div class="product-price" style="font-size: 1.2rem; margin-bottom: 0.25rem;">Rs. {{cart_item.sub_total}}</div>
                          <small style="color: var(--apple-gray-500);">Rs. {{cart_item.product.price}} each</small>
                        </div>
                      </td>
                      <td style="padding: 1.5rem 1rem; text-align: right;">
                        <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" 
                           onclick="return confirm('Are you sure you want to remove this item?')" 
                           class="btn btn-outline-danger" 
                           style="border-radius: var(--border-radius-small);">
                          <i class="fa fa-trash"></i> Remove
                        </a>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Order Summary -->
        <div class="col-lg-4">
          <div class="card" style="border-radius: var(--border-radius-large); position: sticky; top: 2rem;">
            <div class="card-header" style="background-color: var(--apple-gray-50); border-bottom: 1px solid var(--apple-gray-200);">
              <h5 style="color: var(--apple-black); font-weight: var(--font-weight-semibold); margin-bottom: 0;">Order Summary</h5>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <span style="color: var(--apple-gray-600);">Subtotal:</span>
                <span style="color: var(--apple-black); font-weight: var(--font-weight-semibold);">Rs. {{total}}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-3">
                <span style="color: var(--apple-gray-600);">Tax:</span>
                <span style="color: var(--apple-black); font-weight: var(--font-weight-semibold);">Rs. {{tax}}</span>
              </div>
              <hr style="border-color: var(--apple-gray-200); margin: 1.5rem 0;" />
              <div class="d-flex justify-content-between align-items-center mb-4">
                <span style="color: var(--apple-black); font-weight: var(--font-weight-bold); font-size: 1.2rem;">Total:</span>
                <span style="color: var(--apple-black); font-weight: var(--font-weight-bold); font-size: 1.2rem;">Rs. {{grand_total}}</span>
              </div>
              
              <div style="text-align: center; margin-bottom: 1.5rem;">
                <img src="{%static 'images/misc/payments.png'%}" height="26" alt="Payment Methods" />
              </div>
              
              <a href="{%url 'checkout'%}" class="btn btn-primary w-100 mb-3" style="border-radius: var(--border-radius);">
                <i class="fa fa-credit-card mr-2"></i>Proceed to Checkout
              </a>
              <a href="{%url 'store'%}" class="btn btn-outline-primary w-100" style="border-radius: var(--border-radius);">
                <i class="fa fa-shopping-bag mr-2"></i>Continue Shopping
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</section>

{% endblock %}
